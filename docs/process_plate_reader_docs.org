#+TITLE: process\under{}plate\under{}reader\under{}data.py documentation
#+DATE: May 27, 2021
#+OPTIONS: num:nil toc:nil
#+STARTUP: align
#+STARTUP: showall
#+LATEX_HEADER: \usepackage[margin=0.5in]{geometry}
#+LATEX_HEADER: \usepackage[x11names]{xcolor}
#+LATEX_HEADER: \hypersetup{linktoc = all, colorlinks = true, urlcolor = DodgerBlue4, citecolor = PaleGreen1, linkcolor = black}
#+LATEX_HEADER: \usepackage{xltabular}
#+LATEX_COMPILER: lualatex
#+LATEX_CLASS_OPTIONS: [12pt]
#+LATEX_HEADER_EXTRA: \usepackage{fontspec} \setmainfont{Arial}

*Institution: Texas A&M University*

*Department: Biochemistry and Biophysics*

*Center for Phage Technology*

Location: https://github.tamu.edu/cody-martin/CPT_code/plate_reader_code

*Must use your TAMU account* You will need to contact me to get access to this repository.
-----

* S1: INSTALL PYTHON and SHELL
1. You will need to be somewhat familiar with your computer system's shell or command line tool.
   - For MacOS users, press: /CMD + SPACEBAR/ and search "Terminal"
   - For Windows users, press: START, type "PowerShell", and choose
     "Windows PowerShell"

2. To run this script at the command line, you will need to have installed python on your computer. If you're a python beginner, you can install miniconda3: [[https://docs.conda.io/en/latest/miniconda.html]], which has bare minimum python packages.

3. You will then need to install 2 extra python packages:
   | package    | version | build                 | command                          |
   |------------+---------+-----------------------+----------------------------------|
   | pandas     |   1.1.3 | py38hb1e8313\under{}0 | ~conda install pandas=1.1.3~     |
   | openpyxl   |   3.0.5 | py\under{}0           | ~conda install openpyxl=3.0.5~   |
   | matplotlib |   3.3.2 | 0                     | ~conda install matplotlib=3.3.2~ |

4. Then you can clone the repository to your local computer by using this command: ~git clone https://github.tamu.edu/cody-martin/CPT_code.git~
   - You can delete / ignore all the other folders unrelated to ~plate_reader_code~
   - Or you can just manually download the ~.py~ script needed in this directory.
     
5. To change directories (folders) on MacOS/Linux, type: ~cd ~/directory1/directory2/directory3/~ until you are in your desired directory
   - NOTE: "directory1,2,3" should be replaced with the actual folder name
   - For Windows users: I believe you can use the filepath as ~C:\dir1\dir2\dir2~
     
6. You will need to save the code in the same directory (folder) as your raw data from the infinite200Pro plate reader; tecan i-control 1.7.1.12 software. Do NOT edit the data. (Actually, you can just put the full file path, ie ~~/Documents/CPT/N4/plate_data.xlsx/~, instead of just the file name.)

* S2: INPUT FILES
1. You will need to input *two* files to run this code: your raw data
   and your plate setup file.

2. Your raw data must be the unedited .xlsx excel file that is output
   from the tecan i-control software. It should look very similar to
   this:

   [[./process_plate_reader_data_image01.png]]
   [[./process_plate_reader_data_image02.png]]
   - NOTE: your file name must not have spaces! Rename it to have no spaces (just use underscores _ ). This is good coding practice.

3. Your plate reader setup must be a .csv that looks like the example
   below.

   1. You MUST have the headers "row..1..2....12" AND the row letters in
      CAPS!
   2. Name all replicates EXACTLY the same (just copy and paste)
   3. Label your media-only wells as "Blank"
   4. Leave empty wells blank
   5. If for some reason, you scanned wells that you do not want/need to
      analyze, label them "air." The code will then know to ignore those
      wells.
   6. Make sure there are not any extra spaces anywhere
   7. You can make a .csv file in excel. Just save it as .csv
      - Your sample names can now be whatever you want, as long as replicates are named _EXACTLY_ the same.
      - However, I would suggest you use actual sample names instead of a code.
                
      [[./process_plate_reader_data_image03.png]]

* S3: USAGE
1. At the command line, once the script and your input files are in the
   same directory, you can use this code like this:

   #+BEGIN_SRC bash
   python process_plate_reader_data.py -i <rawdata.xlsx> -p <plate_setup.csv> -a <active_sheet_num>
   #+END_SRC

2. A complete command could look like this:

   #+BEGIN_SRC bash
   python process_plate_reader_data.py -i 200221_CCM_n4_lysis_curve_testing.xlsx -p 200221_plate_setup.csv -a 1
   #+END_SRC

3. There are several arguments that can be input when you call the
   script, but the 3 that are most important are -i, -p, and -a.

- -i specifies the input data file
- -p specifies the plate reader setup
- -a specifies the sheet from your input data that has the raw data
- *Note: computers count from 0*, so down below, I would enter 0
  (actually you wouldn't have to do anything because the default setting
  is the first sheet). If the second sheet had the data, I would enter
  1.
- Additionally, for help you can pass -h as your argument to get the
  list of possible args

  [[./process_plate_reader_data_image04.png]]

  Sheet = 0 Sheet = 1 Sheet = 2 Sheet = 3

4. Here are all the possible arguments you can pass and their
   descriptions:

#+ATTR_LATEX: :environment xltabular :width \textwidth :align lX
| Arg | Description                                                                                                                 |
|-----+-----------------------------------------------------------------------------------------------------------------------------|
| -i  | input must be a .xlsx excele file from infinite200 pro plate readerl tecan i-control 1.7.1.12 software                      |
| -p  | plate setup file must be structured a certain way as a .csv -- see the example                                              |
|     | NOTE: replicates must be named exactly the same AND your background media samples called "Blank"                            |
|     | Should you have samples you don't want analyzed or wells that were scanned but you don't want analyzed, label them as "air" |
| -a  | type an integere for the sheet in your .xlsx file with the raw data                                                         |
|     | NOTE: computers start counting at 0 so if your 2nd sheet has the data, type "1"                                             |
|     | DEFAULT=0 (first sheet)                                                                                                     |
| -gs | type your intended graphing program                                                                                         |
|     | options: "excel", "R" DEFAULT="excel"                                                                                       |
|     | "excel" will output wide formatted data                                                                                     |
|     | "R" will output long formatted data for use in R with ggplot2                                                               |
| -pp | bool to autogenerate a python plot                                                                                          |
|     | DEFAULT=True                                                                                                                |
| -y  | y-axis label                                                                                                                |
|     | DEFAULT="OD600"                                                                                                             |
| -gm | type of graphing method for python created graph                                                                            |
|     | options: "time series", "time diff" DEFAULT="time series"                                                                   |
|     | NOTE passing "time diff" does nothing yet TODO                                                                              |
| -pw | type an integer for number of points (readings) per well                                                                    |
|     | DEFAULT=4                                                                                                                   |

* S4: HOW DOES IT WORK

1. The code takes your plate setup file, and groups all replicates
   together. Then it will find the well coordinates for all data in your
   plate, grouping the coordinates for replicates together.

2. Then it parses all the data tables in your raw data file and matches
   the data table with a sample labeled in your plate setup file.

3. Then it will concatenate all data tables together for all replicates
   of a single experimental group. In other words, if you have 3
   replicates of "rapid\under{}lyser\under{}2" in wells B2, B3, and B4, it will take
   the data for wells B2,3, and 4, and create one data table of all 3
   replicates for "rapid\under{}lyser\under{}2."

4. Then it takes the average and standard deviation of all data points
   for a given experimental group at each timepoint. For the tecan
   i-control software, the data includes a certain number of readings
   per well, and then that number is multiplied by the number of
   replicates. The default readings per well number is 4, and if you
   have 3 replicates, that equals 12 data points for each group at each
   timepoint.

5. The average background signal at each timepoint is then subtracted
   from the average signal at the corresponding timepoint for each
   experimental group. This value is what is present in the final
   output. Additionally, the unchanged standard deviation is also
   reported in the final output because it will not change by
   subtracting background signal. (See statistic distribution theory)

6. For the time series plotting, it will plot the relative time (hours)
   on the x-axis, and whatever units your measurements are in on the
   y-axis. For each point, it will also graph the standard error of the
   mean OD \pm SEM. at that timepoint. SEM = standard dev / sqrt(n), where
   n is the number of replicates * number of readings per well.

7. The outputs of this code are a ~datafile_PROCESSED.csv~ file and a
   ~datafile_PROCESSED.pdf~ file. The .csv file contains for all
   experimental groups, the average signal (with background subtracted)
   and standard deviation at each timepoint, as well as the time in
   hours. The .pdf is a python plot.
